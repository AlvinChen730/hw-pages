<!DOCTYPE html>

<html>

<head>
<style>
	#info {
  position: absolute;
  top: 2%;
  width: 100%;
  padding: 10px;
  text-align: center;
  color: #ffff00
}

body {
  overflow: hidden;
}



</style>
</head>

<body> 
	<div id="info">
  <br/>
  <button id="shoot" style="width:15%">start</button>
  <br/>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r78/three.min.js"></script>
<script src="https://dl.dropboxusercontent.com/u/3587259/Code/Threejs/OrbitControls.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://jyunming-chen.github.io/tutsplus/js/KeyboardState.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.min.js"></script>

<script>
	var scene, renderer, camera;

var keyboard = new KeyboardState();
var clock = new THREE.Clock();
var clock2 = new THREE.Clock();
var turn = false, turn2 = true ;
var period = 1;
var long = 0 , v0 = 0;
var pos, vel, force;
var ball;
var v0;
var upangle;
gcontrols = {
    v0: 1106,//左右
    upangle: 35,//上下
    x: 1,
    y:-1,
    z:-2,
    turnAngle:35,
    S:0.1
}
var gui = new dat.GUI({load: loadALVIN(), preset: 'fastball'});
gui.remember (gcontrols);
gui.add(gcontrols, 'v0', 0, 2500 );
gui.add(gcontrols, 'upangle',-2500, 1800);
gui.add(gcontrols, 'turnAngle',-1800, 1800);
gui.add(gcontrols, 'x', -3, 3);
gui.add(gcontrols, 'y', -3, 3);
gui.add(gcontrols, 'z', -3, 3);
gui.add(gcontrols, 'S', 0.001, 1.0);



$('#shoot').click(function() {
 turn = !turn;
  turn2 =true;
  if(turn) {
   clock.start();
    $(this).text("reset");
  }
  else {
   $(this).text("start");
   clock = new THREE.Clock();
    clock2 = new THREE.Clock();
  }   
  // add AxisHelper in init
  // 2D ball state variables: pos, vel, force
  v0=gcontrols.v0;
  upangle=gcontrols.upangle;
  x=gcontrols.x;
  y=gcontrols.y;
  z=gcontrols.z;
  turnAngle=gcontrols.turnAngle;
  omega0 = new THREE.Vector3(x,y,z).normalize();
  nowOmega = omega0.clone();
  pos = new THREE.Vector3 (0, 21, -184); 
  gravity = new THREE.Vector3(0, -98, 0);
  vel = new THREE.Vector3 (0,0,v0).applyAxisAngle (new THREE.Vector3(1,0,0), -Math.PI/upangle);
  vel = vel.applyAxisAngle (new THREE.Vector3(0,1,0), -Math.PI/turnAngle);
  
   // vr = 41.6
});

init();
animate();

var pose1 = {
 connectA : 1.0 , connectB : 0.5
};
var pose2 = {
 connectA : 0.5 , connectB : 0.5
};
var pose3 = {
 connectA : 0 , connectB : 0
};
var pose4= {
 connectA : -0.55 , connectB : -0.65
};
var pose5 = {
 connectA : -1.0 , connectB : -1.0
};
var pose6 = {
 connectA : -0.5 , connectB : 0
};


var keys = [{s: 0,pose: pose1}, 
      {s: 0.3,pose: pose2},
            {s: 0.4,pose: pose3},
            {s: 0.5,pose: pose4},
            {s: 0.6,pose: pose5},
            {s: 1,pose: pose6},
           ]; 

function init() {
 modeling();
 window.addEventListener('resize', onWindowResize, false);
  document.body.appendChild(renderer.domElement);
}

function modeling(){
   THREE.ImageUtils.crossOrigin = '';

  //主頁面
  scene = new THREE.Scene();
  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0xBBFFFF);
  renderer.autoClear = false;
  document.body.appendChild(renderer.domElement);
  //主視角
  
  camera = new THREE.PerspectiveCamera(4, window.innerWidth / window.innerHeight, 1, 10000);
  camera.position.set(-40,75, -750);


  

  //光線
 light = new THREE.PointLight(0xffffff);
  light.position.set(0, 500, -500);
  scene.add(light);
  
  light = new THREE.PointLight(0xffffff);
  light.position.set(0, 500, 500);
  scene.add(light);
  
   camera2 = new THREE.PerspectiveCamera(8, window.innerWidth / window.innerHeight, 1, 10000);
  camera2.position.set(0, 6 , 90);
  
  cameraHUD = new THREE.OrthographicCamera(-10, 10, 10, -10, -10, 100000);
  cameraHUD.position.z = 300;
  
  sceneHUD = new THREE.Scene();
  var fframe = new THREE.Mesh(new THREE.PlaneGeometry(22, 0.5), new THREE.MeshBasicMaterial({
    color: 0xffff34,
    depthTest: false
  }));
  var fup = fframe.clone();
  fup.position.set (0,10,0);
  var fdown = fframe.clone();
  fdown.position.set (0,-10,0);
 sceneHUD.add(fup);
  sceneHUD.add(fdown);
    
  sceneHUD2 = new THREE.Scene();
  var fframe1 = new THREE.Mesh(new THREE.PlaneGeometry(0.5, 20), new THREE.MeshBasicMaterial({
    color: 0xffff34,
    depthTest: false
  }));
  var fright = fframe1.clone();
  fright.position.set (-10,0,0);
  var fleft = fframe1.clone();
  fleft.position.set (10,0,0);
 sceneHUD2.add(fright);
  sceneHUD2.add(fleft);
  /*
  light4 = new THREE.PointLight(0xffffff);
  light4.position.set(-300, 300, -500);
  scene.add(light4);
  
  light5 = new THREE.PointLight(0xffffff);
  light5.position.set(0, 300, 0);
  scene.add(light5);
*/
  /////////////////////////////////////////////////////////////////////////  

  //  1 單位 = 10公分 = 0.1公尺
  // 1公尺 = 10單位

  //球
  baseball = new THREE.Mesh(new THREE.SphereGeometry(1.2, 32, 32), new THREE.MeshLambertMaterial({
    side: THREE.DoubleSide,
    map: THREE.ImageUtils.loadTexture('https://i.imgur.com/ddu5eh4.jpg')
  }));
  var baseballPos = baseball.localToWorld(new THREE.Vector3(0, 0, 0))
  baseball.position.copy(baseballPos);

  //球速度方向標示
  velocityGeometry = new THREE.CylinderGeometry(0.3, 0.3, 5, 32);
  velocityMaterial = new THREE.MeshLambertMaterial({
    color: 0xff0000
  });
  velocity = new THREE.Mesh(velocityGeometry, velocityMaterial);
  velocity.position.set(0, 2.5, 0);
  velArrow = new THREE.Object3D();
  velArrow.add(velocity);
  velArrow.position.set(0,500,0);
  scene.add(velArrow);

  //求選轉方向標示
  omegaGeometry = new THREE.CylinderGeometry(0.3, 0.3, 5, 32);
  omegaMaterial = new THREE.MeshLambertMaterial({
    color: 0xffff00
  });
  omega = new THREE.Mesh(omegaGeometry, omegaMaterial);
  omega.position.set(0, 2.5, 0);
  omegaArrow = new THREE.Object3D();
  omegaArrow.add(omega);
  omegaArrow.position.set(0,500,0);
  scene.add(omegaArrow);

  scene.add(baseball);

 //全場
  grass = new THREE.Mesh(new THREE.PlaneGeometry(1200,1200), new THREE.MeshBasicMaterial({
   side: THREE.DoubleSide,
    map: THREE.ImageUtils.loadTexture('https://i.imgur.com/lM5NGmP.jpg')
  }));
  grass.rotation.x = Math.PI/2;
  grass.rotation.z = Math.PI/4;
  grass.position.set(0,-0.5,-500);
  scene.add(grass);
  

  //內野
  infield = new THREE.Mesh(new THREE.BoxGeometry(274.3, 0.1, 274.3), new THREE.MeshBasicMaterial({
    map: THREE.ImageUtils.loadTexture('https://i.imgur.com/VRj6Sbl.jpg')
  }));
  infield.position.set(0, -193.9, 0);
  //投手丘
  geometrymount = new THREE.CylinderGeometry(1, 18.3, 4, 24);
  materialmount = new THREE.MeshLambertMaterial({
    color: 0x796400,
    side: THREE.DoubleSide,
    map:THREE.ImageUtils.loadTexture('https://i.imgur.com/guh5eKy.jpg')
  });
  mount = new THREE.Mesh(geometrymount, materialmount);
  mount.position.set(0, 1.5, -184);
  geometrymount2 = new THREE.CylinderGeometry(18.3, 18.3, 1, 32);
  materialmount2 = new THREE.MeshLambertMaterial({
    color: 0x796400,
    side: THREE.DoubleSide,
    map:THREE.ImageUtils.loadTexture('https://i.imgur.com/guh5eKy.jpg')
  });
  mount2 = new THREE.Mesh(geometrymount2, materialmount2);
  mount2.position.set(0, 0, -184);
  scene.add(mount);
  //scene.add(mount2);


  geometry = new THREE.BoxGeometry(3.8, 1, 3.8);
  material = new THREE.MeshLambertMaterial({
    color: 0xffffff,
    side: THREE.DoubleSide});



  //一壘
  base1 = new THREE.Mesh(geometry, material);
  base1.position.set(135.3, 0, -137.4);
  infield.add(base1);
  geometrycircle = new THREE.CircleGeometry(30, 32);
  materialcircle = new THREE.MeshLambertMaterial({
    color: 0x796400,
    side: THREE.DoubleSide,
    map:THREE.ImageUtils.loadTexture('https://i.imgur.com/guh5eKy.jpg')
  });
  base1floor = new THREE.Mesh(geometrycircle, materialcircle);
  base1floor.rotation.x = Math.PI / 2;
  base1floor.position.set(135.3, 0.2, -137.4);
  infield.add(base1floor);
  

  //二壘
  base2 = new THREE.Mesh(geometry, material);
  base2.position.set(-137.4, 0, -137.4);
  infield.add(base2);
  base2floor = new THREE.Mesh(geometrycircle, materialcircle);
  base2floor.rotation.x = Math.PI / 2;
  base2floor.position.set(-137.4, 0.2, -137.4);
  infield.add(base2floor);

  //三壘
  base3 = new THREE.Mesh(geometry, material);
  base3.position.set(-137.4, 0, 137.3);
  infield.add(base3);
  base3floor = new THREE.Mesh(geometrycircle, materialcircle);
  base3floor.rotation.x = Math.PI / 2;
  base3floor.position.set(-137.4, 0.2, 137.4);
  infield.add(base3floor);
  

  //本壘
  homebase = new THREE.Object3D();
  homebaseA = new THREE.Mesh(new THREE.BoxGeometry(3, 1, 3), material);
  homebaseA.rotation.y = Math.PI / 4;
  homebaseB = new THREE.Mesh(new THREE.BoxGeometry(4.3, 1, 2.1), material);
  homebase.add(homebaseA);
  homebase.add(homebaseB);
  homebaseA.position.set(0, 0, 1.05);
  homebaseB.position.set(0, 0, 0);
  homebase.position.set(135, 0, 135);
  homebase.rotation.y = Math.PI / 4;
  infield.add(homebase);
 
  
  
  //本壘打擊區
  geometrycircle = new THREE.CircleGeometry(60, 32);
  home = new THREE.Mesh(geometrycircle, materialcircle);
  home.rotation.x = Math.PI / 2;
  home.position.set(135, 0.2, 135);
  infield.add(home);
  geometrycircle = new THREE.CircleGeometry(61, 32, -Math.PI / 2 + 0.05, 4.6);
  materialcircle = new THREE.MeshLambertMaterial({
    color: 0xffffff,
    side: THREE.DoubleSide
  });
  home2 = new THREE.Mesh(geometrycircle, materialcircle);
  home2.rotation.x = Math.PI / 2;
  home2.position.set(135, 0.1, 135);
  infield.add(home2);
 
  //好球帶
  curve0 = new THREE.SplineCurve3([
    new THREE.Vector3(-2.5, 0, 0),
    new THREE.Vector3(2.5, 0, 0),
    new THREE.Vector3(2.5, 7, 0),
    new THREE.Vector3(-2.5, 7, 0),
    new THREE.Vector3(-2.5, 0, 0)
  ]);
  geometrystrikerange = new THREE.Geometry();
  geometrystrikerange.vertices = curve0.getPoints(4);
  materialstrikerange = new THREE.LineBasicMaterial({
    color: 0xff0000
  });
  strikeranger = new THREE.Line(geometrystrikerange, materialstrikerange);
  strikeranger.position.set(0, 4, 0);
  scene.add(strikeranger);
 
  //左打擊格
  curve = new THREE.SplineCurve3([
    new THREE.Vector3(0, 0.5, -6),
    new THREE.Vector3(0, 0.5, 12),
    new THREE.Vector3(9, 0.5, 12),
    new THREE.Vector3(9, 0.5, -6),
    new THREE.Vector3(0, 0.5, -6)
  ]);
  geometrycurve = new THREE.Geometry();
  geometrycurve.vertices = curve.getPoints(4);
  materialcurve = new THREE.LineBasicMaterial({
    color: 0xffffff
  });
  splineObject0 = new THREE.Line(geometrycurve, materialcurve);
  splineObject0.position.set(3, 0, -5);
  scene.add(splineObject0);
  //右打擊格

  splineObject1 = new THREE.Line(geometrycurve, materialcurve);
  splineObject1.position.set(-12, 0, -5);
  scene.add(splineObject1);

  //一壘準備區
  
  base1preparation = new THRE
</script>
</body>

</html>
